<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z jednoduchÃ©ho sloÅ¾itÃ©</title>

    <!-- KaTeX (bundled locally) -->
    <link rel="stylesheet" href="/static/vendor/katex/katex.min.css">
    <script defer src="/static/vendor/katex/katex.min.js"></script>

    <!-- App styles -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>

    <div class="app">

        <!-- â”€â”€ Left sidebar â”€â”€ -->
        <div class="sidebar">

            <!-- Header: logo + title + language toggle -->
            <div style="display:flex; align-items:center; justify-content:space-between;">
                <div class="sidebar-header">
                    <img id="app-logo" src="/static/logo.png" alt="ÃšI AV ÄŒR" onerror="this.style.display='none'">
                    <div class="sidebar-header-text">
                        <div id="app-title" style="font-size:18px; font-weight:700; color:#c8b88a;" data-i18n="title">
                            Z jednoduchÃ©ho sloÅ¾itÃ©
                        </div>
                        <div id="app-subtitle" style="font-size:11px; color:#666; margin-top:2px;">
                            ÃšI AV ÄŒR â€” Veletrh vÄ›dy 2026
                        </div>
                    </div>
                </div>
                <div class="lang-toggle">
                    <button class="lang-btn active" data-lang="cs">CZ</button>
                    <button class="lang-btn" data-lang="en">EN</button>
                </div>
            </div>

            <!-- Simulation tabs (built dynamically by engine.js) -->
            <div class="tabs" id="sim-tabs"></div>

            <!-- Simulation controls (built dynamically by controls.js) -->
            <div id="sim-controls"></div>

            <!-- Action buttons -->
            <div class="actions">
                <button class="action-btn btn-reset" id="btn-reset" data-i18n="reset">âŸ² Resetovat</button>
                <button class="action-btn btn-snapshot" id="btn-snapshot" data-i18n="snapshot">ðŸ“¸ UloÅ¾it
                    pohlednici</button>
            </div>
        </div>

        <!-- â”€â”€ Main canvas area â”€â”€ -->
        <div class="canvas-area">

            <!-- Collapsible equation panel -->
            <div class="equation-panel">
                <div class="eq-header" id="eq-header">
                    <span class="eq-header-title" data-i18n="eq_title">Jak to funguje â€” rovnice</span>
                    <span class="eq-chevron" id="eq-chevron">â–¼</span>
                </div>
                <div class="eq-body" id="eq-body">
                    <div id="eq-body-content"></div>
                </div>
            </div>

            <div class="canvas-wrapper">
                <canvas id="simCanvas"></canvas>
            </div>

            <div class="touch-hint" data-i18n="touch_hint">ðŸ‘† KliknÄ›te na plÃ¡tno a pÅ™idejte novÃ© vzory!</div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast"></div>

    <!-- â”€â”€ Application entry point â”€â”€ -->
    <script type="module">
        import { registerSim, init } from "/static/js/core/engine.js";
        import rdSim from "/static/js/sims/reaction-diffusion.js";
        import oscSim from "/static/js/sims/kuramoto.js";
        import boidsSim from "/static/js/sims/boids.js";

        const ALL_SIMS = { rd: rdSim, osc: oscSim, boids: boidsSim };

        // Fetch config from server, then boot
        fetch("/api/config")
            .then(r => r.json())
            .then(cfg => {
                // Apply branding text
                const lang = cfg.branding.default_lang || "cs";
                const title = lang === "en"
                    ? cfg.branding.title_en
                    : cfg.branding.title_cs;
                const titleEl = document.getElementById("app-title");
                const subtitleEl = document.getElementById("app-subtitle");
                if (titleEl && title) titleEl.textContent = title;
                if (subtitleEl && cfg.branding.subtitle)
                    subtitleEl.textContent = cfg.branding.subtitle;

                // Logo: if a dedicated light-version logo is configured, use it
                // (and remove the CSS invert filter since it's already light).
                const logoEl = document.getElementById("app-logo");
                const lightLogo = cfg.branding.logo_light_path;
                if (logoEl && lightLogo) {
                    logoEl.src = "/static/" + lightLogo.replace(/^static\//, "");
                    logoEl.style.filter = "none";
                }

                // Register only the enabled simulations (in config order)
                for (const id of cfg.simulations) {
                    if (ALL_SIMS[id]) {
                        registerSim(ALL_SIMS[id]);
                        // Apply content overrides from config.toml [content.*]
                        if (cfg.content && cfg.content[id] && ALL_SIMS[id].applyContent) {
                            ALL_SIMS[id].applyContent(cfg.content[id]);
                        }
                    }
                }

                init(lang);
            })
            .catch(() => {
                // Server unreachable â€” register all sims with defaults
                for (const sim of Object.values(ALL_SIMS)) registerSim(sim);
                init();
            });
    </script>

</body>

</html>